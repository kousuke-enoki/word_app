# name: k6 Nightly (B + C)

# on:
#   schedule:
#     - cron: '0 18 * * *' # JST 朝3時想定など
#   workflow_dispatch:

# jobs:
#   k6_nightly:
#     runs-on: ubuntu-latest

#     steps:
#       - uses: actions/checkout@v4

#       - uses: grafana/setup-k6-action@v1

#       - uses: actions/setup-node@v4
#         with:
#           node-version: '22'

#       - name: Prepare output dir & install bench deps
#         run: |
#           mkdir -p bench/k6/out
#           npm --prefix bench ci

#       - name: B-layer 4 APIs (nightly profile)
#         env:
#           BASE_URL: ${{ secrets.STG_BASE_URL }}
#           PROFILE: nightly
#           TEST_EMAIL: ${{ secrets.STG_TEST_EMAIL }}
#           TEST_PASSWORD: ${{ secrets.STG_TEST_PASSWORD }}
#           REGISTER_WORD_ID: ${{ secrets.STG_REGISTER_WORD_ID }}
#         run: |
#           k6 run --summary-export=bench/k6/out/b_search.json   bench/k6/b/search_words.js
#           k6 run --summary-export=bench/k6/out/b_quiz.json     bench/k6/b/quiz_new.js
#           k6 run --summary-export=bench/k6/out/b_signin.json   bench/k6/b/sign_in.js
#           k6 run --summary-export=bench/k6/out/b_register.json bench/k6/b/register_word.js

#       - name: C-1 Cold vs Warm
#         env:
#           BASE_URL: ${{ secrets.STG_BASE_URL }}
#         run: |
#           npm --prefix bench run k6:c:cold

#       - name: C-2 Rate limit (allow failure until implemented)
#         env:
#           BASE_URL: ${{ secrets.STG_BASE_URL }}
#         run: |
#           npm --prefix bench run k6:c:rate
#         continue-on-error: true

#       - name: C-3 DB Before/After set (before)
#         env:
#           BASE_URL: ${{ secrets.STG_BASE_URL }}
#           LABEL: before
#         run: |
#           npm --prefix bench run k6:c:db:before

#       - name: C-3 DB Before/After set (after)
#         env:
#           BASE_URL: ${{ secrets.STG_BASE_URL }}
#           LABEL: after
#         run: |
#           npm --prefix bench run k6:c:db:after

#       - name: Build charts (optional)
#         run: |
#           node bench/tools/mkcharts.js bench/k6/out/b_search.json bench/k6/out/search_rps_p95.html || true

#       - name: Upload artifacts
#         uses: actions/upload-artifact@v4
#         with:
#           name: k6-nightly
#           path: bench/k6/out/**
#           retention-days: 14
